<script src = "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>

<script>

let listing_id = '22354';

var barChart;

$(document).ready(function(){

    set_guest_counter();
    load_popularity_trend();
    load_reviews();

 });

function set_guest_counter() {
    $('#qty_input').prop('disabled', true);
    $('#plus-btn').click(function(){
    	$('#qty_input').val(parseInt($('#qty_input').val()) + 1 );
    	    });
        $('#minus-btn').click(function(){
    	$('#qty_input').val(parseInt($('#qty_input').val()) - 1 );
    	if ($('#qty_input').val() == 0) {
			$('#qty_input').val(1);
		}

    });
}

function load_popularity_trend(){

    $.ajax({
        data: {'listing_id': listing_id },
        method: "GET",
        url: "{%  url "listing:popularity-data"  %}",
        success: function(data){
            console.log(data)

            setBarChart(data)
        },
        error: function(error_data){

            barChart.destroy();

            console.log("error")
            console.log(error_data)
        }
    })
}

function setBarChart(data){

     if(barChart)
    {
        barChart.destroy()
    }

    let ctx = document.getElementById("bar_chart").getContext('2d');
    barChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: data.months,
            datasets: [{
                label: '',
                data: data.values,
                backgroundColor: 'rgba(0, 188, 212, 0.5)',
                borderColor: 'rgba(0, 188, 212, 1)',
                borderWidth: 1
            }],
        },
        options: {
                responsive: true,
                legend: {
                    display: false,
                },
                scales: {
                    xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Month'
                            },
                        gridLines: {
                                display:false
                            }
                        }],
                    yAxes: [{
                            display: true,
                            ticks: {
                                beginAtZero: true,
                                stepValue: 1,
                            },
                        gridLines: {
                                    display:false
                                }
                        }]
                }
            }

    });
}

function load_reviews() {
    $.ajax({
        data: {'listing_id': listing_id },
        method: "GET",
        url: "{%  url "listing:review-data"  %}",
        success: function(data){
            {#console.log(data)#}

            $('#reviews-container').empty();
            $('#reviews-container').append(data)
        },
        error: function(error_data){

            $('#reflections_table').empty();

            console.log("error")
            console.log(error_data)
        }
    })
}

</script>